.DEFAULT_GOAL:=help
SHELL:=/bin/bash

# This Makefile handles some of the common tasks in your project

outputpath=outputs/
configpath=configs/
sampath=build/
currentdatetime:="$(shell date '+%Y-%m-%d_%H-%M%p')"

.PHONY: help

help:  ## Display this help
	@awk 'BEGIN {FS = ":.*##"; printf "\nUsage:\n  make \033[36m<target> \033[0m\n"} /^[a-zA-Z_-]+:.*?##/ { printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2 } /^##@/ { printf "\n\033[1m%s\033[0m\n", substr($$0, 5) } ' $(MAKEFILE_LIST)


##@ Build

rebuild: ## Rebuild the binaries, run this if you've modified the code
	# TODO: Run the `cmake` first
	make -j8 -C build/


parameters: ## Preparing config files for SAM
	mkdir -pv configs
	mkdir -pv outputs
	mkdir -pv logs
	mkdir -pv jobs

	python3 yourprojectname_prepare_config_files.py

database: ## Aggregate output files into a SQLite database
	python3 yourprojectname_to_sqlite.py $(from)

run-seq-local: ## Running the simulation sequentially on the local machine
	./yourprojectname_local_seq_run.sh

run-par-local: ## Running the simulation in parallel on the local machine
	./yourprojectname_local_par_run.sh

run-par-lisa: ## Running the simulation in parallel on the Lisa cluster
	@echo "Need to be updated..."

archive: ## Archiving the entire project directory to ../yourprojectname_analysis/archive/CUREENT_DATE_TIME
	mkdir -pv ../yourprojectname_analysis/archive/$(currentdatetime)
	cp -rv * ../yourprojectname_analysis/archive/$(currentdatetime)

clean: ## Remove most project specific files, configs, jobs, logs, etc.
	rm -vrf configs
	rm -vrf logs
	rm -vrf jobs
	rm configfilenames.pool

	mkdir -pv configs
	mkdir -pv logs
	mkdir -pv jobs

veryclean: clean ## Remove all project files, including outputs 
	rm -vrf build/*
	rm -vrf outputs/*
	rm -vrf dbs/*

	mkdir -pv build
	mkdir -pv outputs
	mkdir -pv dbs